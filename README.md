# Инструкция по использованию системы "ФитоДомик"

## Содержание
1. [Обзор проекта](#обзор-проекта)
2. [Структура проекта](#структура-проекта)
3. [Описание компонентов](#описание-компонентов)
   - [FitoDomik.py](#fitodomikpy)
   - [FitoDomik_console.py](#fitodomik_consolepy)
   - [temp_humidity_light.ino](#temp_humidity_lightino)
4. [Основные функции системы](#основные-функции-системы)
5. [Начало работы](#начало-работы)
6. [Работа с графическим интерфейсом](#работа-с-графическим-интерфейсом)
7. [Работа с консольной версией](#работа-с-консольной-версией)
8. [Настройка Arduino](#настройка-arduino)

## Обзор проекта

Система "ФитоДомик" представляет собой комплексное решение для автоматизации и мониторинга домашней теплицы. Система позволяет:

- Собирать данные с датчиков (температура, влажность воздуха, влажность почвы, освещенность, CO₂, атмосферное давление)
- Управлять устройствами (лампа освещения, шторы)
- Анализировать состояние растений с помощью компьютерного зрения
- Отправлять данные на сервер и получать управляющие сигналы
- Настраивать автоматический режим работы
- Визуализировать данные через графический интерфейс или консоль

## Структура проекта

Проект "ФитоДомик" включает следующие компоненты:

```
python_application/
├── FitoDomik.py              # Графическая версия программы управления
├── FitoDomik.exe             # Скомпилированная версия графической программы
├── 67fb70c98d5b2.ico         # Иконка программы
└── temp_humidity_light/      # Папка с прошивкой для Arduino
    └── temp_humidity_light.ino  # Скетч для Arduino

python_application_console/
└── FitoDomik_console.py      # Консольная версия программы управления
```

## Описание компонентов

### FitoDomik.py

**FitoDomik.py** - это основной файл программы с графическим интерфейсом для управления системой "ФитоДомик".

**Основные возможности:**
- Удобный графический интерфейс с вкладками
- Мониторинг показаний датчиков в реальном времени
- Управление лампой и шторами
- Анализ состояния растений на основе фотографий
- Настройка периодичности опроса датчиков и фотографирования
- Автоматическое сохранение настроек
- Журналирование событий системы
- Взаимодействие с веб-сервером для удаленного мониторинга

**Технические особенности:**
- Использует библиотеку PyQt6 для создания интерфейса
- Многопоточная обработка для одновременного мониторинга и управления
- Обработка изображений с помощью OpenCV
- Взаимодействие с Arduino через последовательный порт
- Отправка и получение данных с сервера через REST API

### FitoDomik_console.py

**FitoDomik_console.py** - это консольная версия программы управления системой "ФитоДомик".

**Основные возможности:**
- Работа в консольном режиме (без графического интерфейса)
- Мониторинг показаний датчиков
- Управление лампой и шторами
- Анализ состояния растений на основе фотографий
- Настройка периодичности опроса датчиков и фотографирования
- Взаимодействие с веб-сервером
- Детальное журналирование событий в консоли

**Технические особенности:**
- Работает в консольном режиме, что делает его подходящим для серверов и систем без графического интерфейса
- Использует те же базовые алгоритмы, что и графическая версия, но с выводом в текстовом формате
- Поддержка локализации для русского языка

### temp_humidity_light.ino

**temp_humidity_light.ino** - это скетч для микроконтроллера Arduino, который управляет датчиками и исполнительными устройствами.

**Основные функции:**
- Сбор данных с датчиков:
  - Температура и влажность воздуха (DHT22)
  - Влажность почвы (аналоговый датчик)
  - Освещенность (BH1750)
- Управление устройствами:
  - Лампа освещения
  - Шторы/занавески
- Отображение информации на LCD-дисплее
- Обмен данными с компьютером через последовательный порт

**Технические особенности:**
- Использует библиотеки для работы с различными датчиками
- Имеет систему переключения режимов отображения на LCD-дисплее
- Принимает команды по последовательному порту и отправляет данные
- Обрабатывает ошибки и перезапускает датчики при необходимости

## Основные функции системы

### Мониторинг параметров окружающей среды

Система непрерывно собирает данные с датчиков:
- **Температура воздуха**: 0-50°C
- **Влажность воздуха**: 0-100%
- **Влажность почвы**: 0-100% (пересчитанная из аналоговых значений)
- **Освещенность**: 0-65535 люкс
- **Уровень CO₂**: 400-5000 ppm (может потребоваться дополнительный датчик)
- **Атмосферное давление**: в гПа (может потребоваться дополнительный датчик)

### Управление устройствами

Система позволяет автоматически или вручную управлять:
- **Лампой освещения**: включение/выключение
- **Шторами**: открытие/закрытие

### Анализ состояния растений

Встроенная система компьютерного зрения анализирует фотографии растений:
- Обнаружение растения на изображении
- Анализ цветовой гаммы листьев
- Определение возможных заболеваний по цветовым признакам
- Рекомендации по уходу на основе анализа
- Периодическое фотографирование и отслеживание динамики

### Взаимодействие с сервером

Система может отправлять данные на сервер и получать управляющие команды:
- Загрузка фотографий и результатов анализа
- Отправка показаний датчиков
- Получение пороговых значений для автоматического управления
- Получение команд для управления устройствами

## Начало работы

### Установка

1. **Графическая версия**:
   - Запустите `FitoDomik.exe` для использования готовой скомпилированной версии
   - Или установите необходимые зависимости и запустите `FitoDomik.py`:
     ```
     pip install PyQt6 numpy opencv-python pyserial requests
     python FitoDomik.py
     ```

2. **Консольная версия**:
   - Установите необходимые зависимости и запустите `FitoDomik_console.py`:
     ```
     pip install numpy opencv-python pyserial requests pillow
     python FitoDomik_console.py
     ```

3. **Arduino**:
   - Установите Arduino IDE
   - Установите библиотеки: DHT, LiquidCrystal, Wire, BH1750
   - Загрузите скетч `temp_humidity_light.ino` на Arduino

### Подключение оборудования

1. Подключите Arduino к компьютеру через USB-кабель
2. Подключите к Arduino следующие компоненты:
   - Датчик влажности и температуры DHT22 к пину 2
   - Датчик влажности почвы к аналоговому пину A0
   - Датчик освещенности BH1750 через I2C (пины SDA и SCL)
   - LCD-дисплей к пинам 6, 7, 8, 9, 10, 11
   - Кнопку переключения к пину 3
   - Реле для управления лампой к пину 13
   - Реле для управления шторами к пину 12

3. Подключите веб-камеру к компьютеру (по умолчанию используется камера с индексом 0)

## Работа с графическим интерфейсом

### Вкладка "Мониторинг"

На этой вкладке отображаются:
- Фотографии растения (оригинальная и обработанная)
- Результаты анализа состояния растения
- Показания всех датчиков
- Состояние устройств (лампа, шторы)
- Кнопка запуска/остановки системы

### Вкладка "Управление"

Позволяет управлять устройствами:
- Включение/выключение лампы
- Открытие/закрытие штор
- Запуск анализа растения (фотографирование и обработка)

### Вкладка "Журнал"

Отображает журнал событий системы:
- Показания датчиков
- Команды управления
- Ошибки и предупреждения
- Результаты анализа

Здесь также можно:
- Очистить журнал
- Сохранить журнал в файл

### Вкладка "Настройки"

Позволяет настроить:
- API токен для взаимодействия с сервером
- COM-порт и скорость для Arduino
- Индекс камеры
- Интервал опроса датчиков
- Режим фотографирования (один раз в день, два раза в день, каждые 10 минут)
- Время выполнения фотографий

## Работа с консольной версией

Консольная версия предлагает те же функции, но управляется через командную строку:

1. При запуске программа запросит API токен
2. Затем будет предложено выполнить первичный анализ растения
3. Далее необходимо указать интервал отправки данных на сервер
4. После этого следует указать интервал фотографирования
5. Программа подключится к Arduino и начнет мониторинг

Все данные отображаются в консоли в виде текстовых сообщений.

## Настройка Arduino

### Подключение датчиков

Скетч `temp_humidity_light.ino` настроен на следующую конфигурацию:

- **LCD-дисплей (16x2)**: 
  - RS -> Пин 6
  - EN -> Пин 7
  - D4 -> Пин 8
  - D5 -> Пин 9
  - D6 -> Пин 10
  - D7 -> Пин 11

- **Датчик DHT22**:
  - Сигнальный пин -> Пин 2

- **Датчик влажности почвы**:
  - Аналоговый сигнал -> Пин A0

- **Датчик освещенности BH1750**:
  - SDA -> Пин SDA Arduino (зависит от модели)
  - SCL -> Пин SCL Arduino (зависит от модели)

- **Кнопка переключения режимов**:
  - Сигнальный пин -> Пин 3

- **Управление лампой**:
  - Сигнальный пин -> Пин 13

- **Управление шторами**:
  - Сигнальный пин -> Пин 12

### Функциональность скетча

Скетч обеспечивает:

1. **Отображение данных на LCD-дисплее**:
   - Влажность почвы
   - Температура и влажность воздуха
   - Уровень освещенности
   - Состояние устройств

2. **Переключение режимов отображения**:
   - Кнопкой
   - Автоматически каждые 5 секунд

3. **Взаимодействие с компьютером**:
   - Отправка данных датчиков в формате текстовых строк
   - Прием команд в формате "УСТРОЙСТВО:СОСТОЯНИЕ"
   - Подтверждение получения команд

4. **Обработка ошибок**:
   - Повторная инициализация датчиков при сбоях
   - Сообщения об ошибках на дисплее и в Serial 
